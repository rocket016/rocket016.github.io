{"title":"科技节智能车小记","uid":"5a4916485d9685034cdde3acb00444a2","slug":"科技节智能车小记","date":"2022-11-17T09:04:00.000Z","updated":"2022-11-21T15:15:21.725Z","comments":true,"path":"api/articles/科技节智能车小记.json","keywords":null,"cover":"https://s1.ax1x.com/2022/11/19/zKFUHI.jpg","content":"<h1 id=\"比赛要求\"><a href=\"#比赛要求\" class=\"headerlink\" title=\"比赛要求\"></a>比赛要求</h1><p>本次科技节比赛要求通过遥控和电磁的方式，让小车绕着赛道跑一圈，时间最短者获胜</p>\n<ul>\n<li>遥控器和小车必须用单片机控制</li>\n<li>PCB必须自制或者用洞洞板</li>\n</ul>\n<p>赛道如下：</p>\n<p><img src=\"https://s1.ax1x.com/2022/11/19/zKCI8e.png\" alt=\"场地\"></p>\n<blockquote><span class=\"custom-blockquote-svg\"><svg width=\"24\" height=\"24\" viewBox=\"0 0 24 24\" fill=\"\" xmlns=\"http://www.w3.org/2000/svg\" data-reactroot=\"\">\n<path fill=\"\" d=\"M22 12C22 6.5 17.5 2 12 2C6.5 2 2 6.5 2 12C2 17.5 6.5 22 12 22C13.8 22 15.5 21.5 17 20.6L22 22L20.7 17C21.5 15.5 22 13.8 22 12Z\" undefined=\"1\"></path>\n<path fill=\"\" d=\"M15.97 11.5H16.04C17.12 11.5 18 12.38 18 13.47V13.53C18 14.62 17.12 15.5 16.03 15.5H15.96C14.88 15.5 14 14.62 14 13.53V13.46C14 12.38 14.88 11.5 15.97 11.5Z\" undefined=\"1\"></path>\n<path fill=\"\" d=\"M7.97 11.5H8.04C9.12 11.5 10 12.38 10 13.47V13.53C10 14.62 9.12 15.5 8.03 15.5H7.97C6.88 15.5 6 14.62 6 13.53V13.46C6 12.38 6.88 11.5 7.97 11.5Z\" undefined=\"1\"></path>\n<path stroke-linejoin=\"round\" stroke-linecap=\"round\" stroke-miterlimit=\"10\" stroke-width=\"2\" stroke=\"\" d=\"M17 8.5C15.23 8.97 14.07 10.84 14.01 13.27C14 13.33 14 13.4 14 13.47V13.5\"></path>\n<path stroke-linejoin=\"round\" stroke-linecap=\"round\" stroke-miterlimit=\"10\" stroke-width=\"2\" stroke=\"\" d=\"M9 8.5C7.23 8.97 6.07 10.84 6.01 13.27C6 13.33 6 13.4 6 13.47V13.5\"></path>\n<path stroke-linejoin=\"round\" stroke-linecap=\"round\" stroke-miterlimit=\"10\" stroke-width=\"2\" stroke=\"\" d=\"M15.97 11.5H16.04C17.12 11.5 18 12.38 18 13.47V13.53C18 14.62 17.12 15.5 16.03 15.5H15.96C14.88 15.5 14 14.62 14 13.53V13.46C14 12.38 14.88 11.5 15.97 11.5Z\"></path>\n<path stroke-linejoin=\"round\" stroke-linecap=\"round\" stroke-miterlimit=\"10\" stroke-width=\"2\" stroke=\"\" d=\"M7.97 11.5H8.04C9.12 11.5 10 12.38 10 13.47V13.53C10 14.62 9.12 15.5 8.03 15.5H7.97C6.88 15.5 6 14.62 6 13.53V13.46C6 12.38 6.88 11.5 7.97 11.5Z\"></path>\n</svg>\n</span><p><del>（并没有三叉路口，对新生十分友好）</del></p></blockquote>\n<h1 id=\"设计思路\"><a href=\"#设计思路\" class=\"headerlink\" title=\"设计思路\"></a>设计思路</h1><h2 id=\"总体思路\"><a href=\"#总体思路\" class=\"headerlink\" title=\"总体思路\"></a>总体思路</h2><h3 id=\"开发板\"><a href=\"#开发板\" class=\"headerlink\" title=\"开发板\"></a>开发板</h3><p>为了在短时间内快速完成开发，采用了arduino开发板</p>\n<p><img src=\"https://s1.ax1x.com/2022/11/19/zKC5CD.png\" alt=\"image-20221118164812859\"><br><em>谁能拒绝一块粉色的开发板呢</em></p>\n<h3 id=\"车模\"><a href=\"#车模\" class=\"headerlink\" title=\"车模\"></a>车模</h3><p>车模方面，一开始使用最便宜的4个电机的小车，但发现效果太垃圾了</p>\n<p>首先，电机也没有编码器，无法准确控制车轮的转速</p>\n<p>其次，转速根本不够快，<del>很难在内卷的时代获胜</del></p>\n<p>可能是学长看到我的车模太垃圾了，友情提供了一个车模，技术参数如下：</p>\n<ul>\n<li>采用520电机驱动，最高支持电压12V</li>\n<li>自带霍尔编码器，精度为330脉冲/转</li>\n</ul>\n<p>图片如下：</p>\n<p><img src=\"https://s1.ax1x.com/2022/11/21/zlsQ4e.jpg\" alt=\"车模图片\"></p>\n<h3 id=\"电机驱动\"><a href=\"#电机驱动\" class=\"headerlink\" title=\"电机驱动\"></a>电机驱动</h3><p>考虑到电流不会特别大，于是采用了性价比最高的<strong>DRV8833</strong>驱动板</p>\n<ul>\n<li>支持pwm控制，<strong>可以调速</strong></li>\n<li>最大10.8V电压和1.5A电流 <em>(比赛的时候直接上12V了，也没炸)</em></li>\n</ul>\n<h2 id=\"遥控车思路\"><a href=\"#遥控车思路\" class=\"headerlink\" title=\"遥控车思路\"></a>遥控车思路</h2><h4 id=\"首先，需要有一个遥控器\"><a href=\"#首先，需要有一个遥控器\" class=\"headerlink\" title=\"首先，需要有一个遥控器\"></a>首先，需要有一个遥控器</h4><p>结合玩遥控车的经验，采用arduino+摇杆电位计的方式</p>\n<p>最初的设计图如下：</p>\n<p><img src=\"https://s1.ax1x.com/2022/11/19/zKCogH.png\" alt=\"image-20221118165516872\"></p>\n<p>摇杆返回模拟值电压，通过arduino自带的ADC，转成0-1024的整型值</p>\n<pre class=\"line-numbers language-c\" data-language=\"c\"><code class=\"language-c\"><span class=\"token keyword\">int</span> x1 <span class=\"token operator\">=</span> <span class=\"token function\">analogRead</span><span class=\"token punctuation\">(</span>A1<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span><span class=\"token comment\">//left</span>\n<span class=\"token keyword\">int</span> x2 <span class=\"token operator\">=</span> <span class=\"token function\">analogRead</span><span class=\"token punctuation\">(</span>A2<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span><span class=\"token comment\">//right</span><span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span></span></code></pre>\n\n<h4 id=\"接着，要进行通信\"><a href=\"#接着，要进行通信\" class=\"headerlink\" title=\"接着，要进行通信\"></a>接着，要进行通信</h4><p>通信方面，采用HC-12 wifi无线串口模块，默认波特率9600</p>\n<p>发送的时候，将左右摇杆的数值组合为<strong>字符串</strong>，并且使用<strong>分隔符</strong>，确保接受端能正常接收。</p>\n<pre class=\"line-numbers language-c++\" data-language=\"c++\"><code class=\"language-c++\">HC.print(&#39;L&#39;);\nHC.print(leftsig);&#x2F;&#x2F;符号\nHC.print(sendleft);&#x2F;&#x2F;数值\nHC.print(&#39;R&#39;);&#x2F;&#x2F;分隔符\nHC.print(rightsig);&#x2F;&#x2F;符号\nHC.print(sendright);&#x2F;&#x2F;数值\nHC.print(&#39;x&#39;);\nHC.print(&#39;z&#39;);<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>\n\n<p>接收的时候，由于长度不固定，需要全部读入，arduino里面有一个<strong>readStringUntil</strong>函数，十分滴好用。我发送的时候采用z结尾，所以可以完整的读到全部数据。</p>\n<p>然后，对接收到的数据进行分割，按照位转化成整型数，代码如下 <em>（点击可展开）</em></p>\n<details class=\"custom-details\">\n<summary>Details</summary>\n<p><pre class=\"line-numbers language-c++\" data-language=\"c++\"><code class=\"language-c++\">&#x2F;&#x2F;接收的数据 L+100R+100xz\nj&#x3D;0;\nrec&#x3D;HC.readStringUntil(&#39;z&#39;);\nlen&#x3D;rec.length();\nwhile(i&lt;len&amp;&amp;rec[i]!&#x3D;&#39;R&#39;)\n&#123;\n    i++;\n&#125;\nswitch(i)\n&#123;\n    case 5:&#x2F;&#x2F;表示有5位（L+100）的情况，直接为100\n    &#123;\n        if(rec[1]&#x3D;&#x3D;&#39;+&#39;)\n            left&#x3D;100;\n        else\n        \tleft&#x3D;-100;\n        break;\n    &#125;\n    case 4:&#x2F;&#x2F;4位（数字两位），依次转化\n    &#123;\n        if(rec[1]&#x3D;&#x3D;&#39;+&#39;)\n        \tleft&#x3D;10*(rec[2]-&#39;0&#39;)+rec[3]-&#39;0&#39;;\n        else\n        \tleft&#x3D;-(10*(rec[2]-&#39;0&#39;)+rec[3]-&#39;0&#39;);\n        break;\n    &#125;\n    case 3:&#x2F;&#x2F;3位（数字只有一位）\n    &#123;\n        if(rec[1]&#x3D;&#x3D;&#39;+&#39;)\n        \tleft&#x3D;rec[2]-&#39;0&#39;;\n        else\n        \tleft&#x3D;-(rec[2]-&#39;0&#39;);\n        break;\n    &#125;\n    default:\n    \tleft&#x3D;0;\n&#125;<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>\n\n\n\n</p>\n</details>\n<h4 id=\"再者，要让车跑起来\"><a href=\"#再者，要让车跑起来\" class=\"headerlink\" title=\"再者，要让车跑起来\"></a>再者，要让车跑起来</h4><p>首先，要接收编码器的数据。</p>\n<p>霍尔编码器，每转过一定角度就会产生一次脉冲，因此，可以使用<strong>io口中断</strong>的方式，每收到一次脉冲，计数器+1，只要计数周期恒定，<strong>计数的多少就反映了当前的转速</strong>。</p>\n<p>还要判断正反转，传感器有AB相位，A为高，B为低时正转，反则为反转</p>\n<p>下图为正转的时候ab相位的输出波形图：</p>\n<p><img src=\"https://s1.ax1x.com/2022/11/19/zKCfUK.png\" alt=\"正转时的相位\"></p>\n<p>判断代码如下：</p>\n<pre class=\"line-numbers language-c++\" data-language=\"c++\"><code class=\"language-c++\">attachInterrupt(digitalPinToInterrupt(2), left, RISING);&#x2F;&#x2F;启用2口中断\nvoid left()\n&#123;\n  if(digitalRead(10)&#x3D;&#x3D;1)\n  \tleftcount++;\n  else\n  \tleftcount--;\n&#125;<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>\n\n<p>这样即可获得转速，每次循环结束读取数值之后，将数值清零就行了</p>\n<p>接着，采用<strong>pid</strong>算法，对电机进行控制</p>\n<p>我这里只用了p和d控制，已经获得了不错的效果，对于突然变化的负载的反应速度还算可以。</p>\n<div class=\"custom-quote warning\">\n<span class=\"custom-quote-svg\"><svg width=\"24\" height=\"24\" viewBox=\"0 0 24 24\" fill=\"\" xmlns=\"http://www.w3.org/2000/svg\" data-reactroot=\"\">\n<path fill=\"\" d=\"M20.86 14.13C20 14.7 19.56 15.74 19.77 16.76C20.13 18.55 18.55 20.13 16.76 19.77C15.74 19.57 14.7 20 14.13 20.86C13.12 22.38 10.89 22.38 9.88 20.86C9.3 20 8.26 19.56 7.24 19.77C5.45 20.13 3.87 18.55 4.23 16.76C4.43 15.74 4 14.7 3.14 14.13C1.62 13.12 1.62 10.89 3.14 9.88C4 9.3 4.44 8.26 4.23 7.24C3.87 5.45 5.45 3.87 7.24 4.23C8.26 4.44 9.3 4 9.87 3.14C10.88 1.62 13.11 1.62 14.12 3.14C14.7 4 15.74 4.44 16.76 4.23C18.55 3.87 20.13 5.45 19.77 7.24C19.56 8.26 20 9.3 20.86 9.87C22.38 10.88 22.38 13.12 20.86 14.13Z\" undefined=\"1\"></path>\n<path stroke-linejoin=\"round\" stroke-linecap=\"round\" stroke-miterlimit=\"10\" stroke-width=\"2\" stroke=\"\" d=\"M12 8V13\"></path>\n<path stroke-linejoin=\"round\" stroke-linecap=\"round\" stroke-miterlimit=\"10\" stroke-width=\"2\" stroke=\"\" d=\"M12 15.99V16.01\"></path>\n</svg>\n</span>\n<p class=\"custom-quote-title\">WARNING</p>\n<p>提示：控制电机的转速需要用到<strong>增量式pid算法</strong>，而不是位置式</p>\n</div>\n<blockquote><span class=\"custom-blockquote-svg\"><svg width=\"24\" height=\"24\" viewBox=\"0 0 24 24\" fill=\"\" xmlns=\"http://www.w3.org/2000/svg\" data-reactroot=\"\">\n<path fill=\"\" d=\"M22 12C22 6.5 17.5 2 12 2C6.5 2 2 6.5 2 12C2 17.5 6.5 22 12 22C13.8 22 15.5 21.5 17 20.6L22 22L20.7 17C21.5 15.5 22 13.8 22 12Z\" undefined=\"1\"></path>\n<path fill=\"\" d=\"M15.97 11.5H16.04C17.12 11.5 18 12.38 18 13.47V13.53C18 14.62 17.12 15.5 16.03 15.5H15.96C14.88 15.5 14 14.62 14 13.53V13.46C14 12.38 14.88 11.5 15.97 11.5Z\" undefined=\"1\"></path>\n<path fill=\"\" d=\"M7.97 11.5H8.04C9.12 11.5 10 12.38 10 13.47V13.53C10 14.62 9.12 15.5 8.03 15.5H7.97C6.88 15.5 6 14.62 6 13.53V13.46C6 12.38 6.88 11.5 7.97 11.5Z\" undefined=\"1\"></path>\n<path stroke-linejoin=\"round\" stroke-linecap=\"round\" stroke-miterlimit=\"10\" stroke-width=\"2\" stroke=\"\" d=\"M17 8.5C15.23 8.97 14.07 10.84 14.01 13.27C14 13.33 14 13.4 14 13.47V13.5\"></path>\n<path stroke-linejoin=\"round\" stroke-linecap=\"round\" stroke-miterlimit=\"10\" stroke-width=\"2\" stroke=\"\" d=\"M9 8.5C7.23 8.97 6.07 10.84 6.01 13.27C6 13.33 6 13.4 6 13.47V13.5\"></path>\n<path stroke-linejoin=\"round\" stroke-linecap=\"round\" stroke-miterlimit=\"10\" stroke-width=\"2\" stroke=\"\" d=\"M15.97 11.5H16.04C17.12 11.5 18 12.38 18 13.47V13.53C18 14.62 17.12 15.5 16.03 15.5H15.96C14.88 15.5 14 14.62 14 13.53V13.46C14 12.38 14.88 11.5 15.97 11.5Z\"></path>\n<path stroke-linejoin=\"round\" stroke-linecap=\"round\" stroke-miterlimit=\"10\" stroke-width=\"2\" stroke=\"\" d=\"M7.97 11.5H8.04C9.12 11.5 10 12.38 10 13.47V13.53C10 14.62 9.12 15.5 8.03 15.5H7.97C6.88 15.5 6 14.62 6 13.53V13.46C6 12.38 6.88 11.5 7.97 11.5Z\"></path>\n</svg>\n</span><p>关于pid算法的原理和两种pid的区别，我（可能）会再写一篇文章来解释</p></blockquote>\n<p>然后，将pid计算之后的转速信号转化为pwm，输入到电机驱动板之中，就可以控制小车的转速了。</p>\n<p><strong>至此，遥控车的制作完成，剩下的就是练操作以及熟悉赛道了</strong></p>\n<h3 id=\"电磁车思路\"><a href=\"#电磁车思路\" class=\"headerlink\" title=\"电磁车思路\"></a>电磁车思路</h3><p>电磁车和寻迹小车差不多，只不过，电磁电磁车巡的是电磁赛道。</p>\n<p>赛道中央会有一条电线，其中通有20kHz，100mA的<strong>正弦交流电</strong>。</p>\n<p>根据高中知识，交流电会在电线附近激发交变磁场</p>\n<p>通过电磁传感器搭载的电感，可以感知磁场，从而感知车辆偏离中心线的程度。</p>\n<p><img src=\"https://s1.ax1x.com/2022/11/19/zKCh4O.png\" alt=\"电磁传感器\"></p>\n<p>输出的是四个电感感应到的数值，实测数值在100-500之间</p>\n<p>进行<strong>归一化处理</strong>，限制幅度，方便计算误差 <em>(其实就是把得到的数值都除以一个常数)</em></p>\n<p>接着，进行p计算，将两边电感的差值乘以一个系数，加到左右车轮的转速上，实现控制小车的转向</p>\n<p>经过一番调参，最终实现小车的寻迹</p>\n<p>核心代码如下：</p>\n<pre class=\"line-numbers language-c++\" data-language=\"c++\"><code class=\"language-c++\">&#x2F;&#x2F;读取电感\nfloat x1 &#x3D; analogRead(A0)&#x2F;3.0;\nfloat x2 &#x3D; analogRead(A1)&#x2F;3.0;\nfloat x3 &#x3D; analogRead(A2)&#x2F;3.0;\nfloat x4 &#x3D; analogRead(A3)&#x2F;3.0;\nfloat err2&#x3D;(x1+x2)&#x2F;2-(x3+x4)&#x2F;2;&#x2F;&#x2F;取平均值，最终的误差\nfloat basespeed&#x3D;90;&#x2F;&#x2F;基础转速\n&#x2F;&#x2F;计算两轮转速\nleftpid(basespeed-err3*p);&#x2F;&#x2F;差速转向\nrightpid(basespeed+err3*p);<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>\n\n<h1 id=\"比赛结果\"><a href=\"#比赛结果\" class=\"headerlink\" title=\"比赛结果\"></a>比赛结果</h1><p>首先，感谢大二学长的不杀之恩，毕竟他们的车模和代码是去打国赛的啊…</p>\n<p>最后，在12.6V电压的“超频”下，本车包揽两个组别的第一，成绩如下</p>\n<ul>\n<li>遥控组<strong>18.8</strong>s</li>\n<li>电磁组<strong>19.8</strong>s</li>\n<li>获得共计<strong>1200</strong>元奖金  <em>(虽然下学期才到账)</em></li>\n</ul>\n<p><img src=\"https://s1.ax1x.com/2022/11/21/zlsX5D.png\" alt=\"image-20221121230657857\"></p>\n<p><img src=\"https://s1.ax1x.com/2022/11/21/zlsOUO.png\" alt=\"image-20221121230627655\"></p>\n<blockquote><span class=\"custom-blockquote-svg\"><svg width=\"24\" height=\"24\" viewBox=\"0 0 24 24\" fill=\"\" xmlns=\"http://www.w3.org/2000/svg\" data-reactroot=\"\">\n<path fill=\"\" d=\"M22 12C22 6.5 17.5 2 12 2C6.5 2 2 6.5 2 12C2 17.5 6.5 22 12 22C13.8 22 15.5 21.5 17 20.6L22 22L20.7 17C21.5 15.5 22 13.8 22 12Z\" undefined=\"1\"></path>\n<path fill=\"\" d=\"M15.97 11.5H16.04C17.12 11.5 18 12.38 18 13.47V13.53C18 14.62 17.12 15.5 16.03 15.5H15.96C14.88 15.5 14 14.62 14 13.53V13.46C14 12.38 14.88 11.5 15.97 11.5Z\" undefined=\"1\"></path>\n<path fill=\"\" d=\"M7.97 11.5H8.04C9.12 11.5 10 12.38 10 13.47V13.53C10 14.62 9.12 15.5 8.03 15.5H7.97C6.88 15.5 6 14.62 6 13.53V13.46C6 12.38 6.88 11.5 7.97 11.5Z\" undefined=\"1\"></path>\n<path stroke-linejoin=\"round\" stroke-linecap=\"round\" stroke-miterlimit=\"10\" stroke-width=\"2\" stroke=\"\" d=\"M17 8.5C15.23 8.97 14.07 10.84 14.01 13.27C14 13.33 14 13.4 14 13.47V13.5\"></path>\n<path stroke-linejoin=\"round\" stroke-linecap=\"round\" stroke-miterlimit=\"10\" stroke-width=\"2\" stroke=\"\" d=\"M9 8.5C7.23 8.97 6.07 10.84 6.01 13.27C6 13.33 6 13.4 6 13.47V13.5\"></path>\n<path stroke-linejoin=\"round\" stroke-linecap=\"round\" stroke-miterlimit=\"10\" stroke-width=\"2\" stroke=\"\" d=\"M15.97 11.5H16.04C17.12 11.5 18 12.38 18 13.47V13.53C18 14.62 17.12 15.5 16.03 15.5H15.96C14.88 15.5 14 14.62 14 13.53V13.46C14 12.38 14.88 11.5 15.97 11.5Z\"></path>\n<path stroke-linejoin=\"round\" stroke-linecap=\"round\" stroke-miterlimit=\"10\" stroke-width=\"2\" stroke=\"\" d=\"M7.97 11.5H8.04C9.12 11.5 10 12.38 10 13.47V13.53C10 14.62 9.12 15.5 8.03 15.5H7.97C6.88 15.5 6 14.62 6 13.53V13.46C6 12.38 6.88 11.5 7.97 11.5Z\"></path>\n</svg>\n</span><p>最后，本项目所有代码如下，欢迎交流</p>\n<p><del>抄也没用，比赛已经打完了了</del></p></blockquote>\n<h2 id=\"开源环节\"><a href=\"#开源环节\" class=\"headerlink\" title=\"开源环节\"></a>开源环节</h2><h3 id=\"遥控组发送（遥控器代码）\"><a href=\"#遥控组发送（遥控器代码）\" class=\"headerlink\" title=\"遥控组发送（遥控器代码）\"></a>遥控组发送（遥控器代码）</h3><details class=\"custom-details\">\n<summary>Details</summary>\n<p><pre class=\"line-numbers language-c++\" data-language=\"c++\"><code class=\"language-c++\">#include &lt;SoftwareSerial.h&gt;\nSoftwareSerial HC(3,2);&#x2F;&#x2F;RX&#x3D;3,TX&#x3D;2\nvoid setup() &#123;\n  &#x2F;&#x2F; put your setup code here, to run once:\n Serial.begin(9600);\n HC.begin(9600);\n pinMode(4, OUTPUT); \n pinMode(5, OUTPUT); \n pinMode(6, OUTPUT); \n pinMode(7, OUTPUT); \n pinMode(8, OUTPUT); \n pinMode(9, OUTPUT); \n pinMode(10, OUTPUT); \n pinMode(11, OUTPUT); \n pinMode(12, OUTPUT); \n pinMode(A1, INPUT);\n pinMode(A2, INPUT);\n for(int i&#x3D;4;i&lt;&#x3D;13;i++)\n &#123;\n    digitalWrite(i,0);\n &#125;\n digitalWrite(4,1);\n digitalWrite(9,1);\n for(int i&#x3D;0;i&lt;4;i++)\n &#123;\n    digitalWrite(i+4,0);\n    digitalWrite(i+9,0);\n    digitalWrite(i+5,1);\n    digitalWrite(i+10,1);\n    delay(100);\n &#125;\n for(int i&#x3D;4;i&lt;&#x3D;13;i++)\n &#123;\n    digitalWrite(i,0);\n &#125;\n digitalWrite(11,1);\n&#125;\nfloat left;\nfloat right;\nint sendleft&#x3D;0;\nint sendright&#x3D;0;\nchar charleft;\nchar leftsig;\nchar rightsig;\nchar charright;\nint gcount&#x3D;0;&#x2F;&#x2F;             \nint light[14]&#x3D;&#123;0&#125;;&#x2F;&#x2F;分别代表 \nvoid loop() \n&#123;\n  &#x2F;&#x2F; put your main code here, to run repeatedly:\n  \n  delayMicroseconds(100);&#x2F;&#x2F;主延时\n  gcount++;\n  if(gcount&#x3D;&#x3D;200)\n  &#123;\n    gcount&#x3D;0;\n  int x1 &#x3D; analogRead(A1);&#x2F;&#x2F;left\n  int x2 &#x3D; analogRead(A2);&#x2F;&#x2F;right\n  &#x2F;&#x2F;Serial.println(x1);\n  &#x2F;&#x2F;left判定\n  \n  if(abs(x1-541)&gt;&#x3D;3)\n  &#123;\n    if(x1-514&gt;0)\n      left&#x3D;(x1-514)&#x2F;509.0;\n    else\n      left&#x3D;(x1-514)&#x2F;514.0;\n  &#125;\n  else\n  &#123;\n    left&#x3D;0;\n  &#125;\n  if(left&gt;100)\n  &#123;\n    left&#x3D;100;\n  &#125;\n  if(left&lt;-100)\n  &#123;\n    left&#x3D;-100;\n  &#125;\n\n  \n  if(abs(x2-533)&gt;&#x3D;5)\n  &#123;\n    if(x2-533&gt;0)\n      right&#x3D;(x2-533)&#x2F;490.0;\n\n    else\n      right&#x3D;(x2-533)&#x2F;533.0;\n  &#125;\n  else\n  &#123;\n    right&#x3D;0;\n  &#125;\n  \n  if(right&gt;100)\n  &#123;\n    right&#x3D;100.0;\n  &#125;\n  if(right&lt;-100)\n  &#123;\n    right&#x3D;-100.0;\n  &#125;\n  \n  sendleft&#x3D;left*100;\n  sendright&#x3D;right*100;\n\n  &#x2F;&#x2F;led灯效 --------------------------------------led part-------------------------------\n\n  if(sendleft&lt;&#x3D;0)\n  &#123;\n    for(int i&#x3D;4;i&lt;&#x3D;8;i++)\n      light[i]&#x3D;0;\n  &#125;\n  else\n  if(sendleft&gt;0&amp;&amp;sendleft&lt;&#x3D;20)\n  &#123;\n    light[8]&#x3D;1;\n    for(int i&#x3D;4;i&lt;&#x3D;7;i++)\n      light[i]&#x3D;0;\n  &#125;\n  else\n  if(sendleft&gt;20&amp;&amp;sendleft&lt;&#x3D;40)\n  &#123;\n    light[8]&#x3D;1;\n    light[7]&#x3D;1;\n    light[6]&#x3D;0;\n    light[5]&#x3D;0;\n    light[4]&#x3D;0;\n  &#125;\n  else\n  if(sendleft&gt;40&amp;&amp;sendleft&lt;&#x3D;60)\n  &#123;\n    light[8]&#x3D;1;\n    light[7]&#x3D;1;\n    light[6]&#x3D;1;\n    light[5]&#x3D;0;\n    light[4]&#x3D;0;\n  &#125;\n  else\n  if(sendleft&gt;60&amp;&amp;sendleft&lt;&#x3D;80)\n  &#123;\n    light[8]&#x3D;1;\n    light[7]&#x3D;1;\n    light[6]&#x3D;1;\n    light[5]&#x3D;1;\n    light[4]&#x3D;0;\n  &#125;\n  else\n  &#123;\n    light[8]&#x3D;1;\n    light[7]&#x3D;1;\n    light[6]&#x3D;1;\n    light[5]&#x3D;1;\n    light[4]&#x3D;1;\n  &#125;\n&#x2F;&#x2F; left led--------------------------------------------left led end-----------------------------\n  if(sendright&gt;80)\n  &#123;\n    light[9]&#x3D;0;\n    light[10]&#x3D;0;\n    light[11]&#x3D;1;\n    light[12]&#x3D;1;\n    light[13]&#x3D;1;\n  &#125;\n  else\n  if(sendright&lt;80&amp;&amp;sendright&gt;&#x3D;40)\n  &#123;\n    light[9]&#x3D;0;\n    light[10]&#x3D;0;\n    light[11]&#x3D;1;\n    light[12]&#x3D;1;\n    light[13]&#x3D;0;\n  &#125;\n  else\n  if(abs(sendright)&lt;40)\n  &#123;\n    light[9]&#x3D;0;\n    light[10]&#x3D;0;\n    light[11]&#x3D;1;\n    light[12]&#x3D;0;\n    light[13]&#x3D;0;\n  &#125;\n  else\n  if(sendright&lt;&#x3D;-40&amp;&amp;sendright&gt;&#x3D;-80)\n  &#123;\n    light[9]&#x3D;0;\n    light[10]&#x3D;1;\n    light[11]&#x3D;1;\n    light[12]&#x3D;0;\n    light[13]&#x3D;0;\n  &#125;\n  else\n  &#123;\n    light[9]&#x3D;1;\n    light[10]&#x3D;1;\n    light[11]&#x3D;1;\n    light[12]&#x3D;0;\n    light[13]&#x3D;0;\n  &#125;\n  \n  if(sendleft&gt;&#x3D;0) leftsig&#x3D;&#39;+&#39;;\n  else leftsig&#x3D;&#39;-&#39;;\n\n  if(sendright&gt;&#x3D;0) rightsig&#x3D;&#39;+&#39;;\n  else rightsig&#x3D;&#39;-&#39;;\n  &#x2F;&#x2F;符号处理\n\n  sendleft&#x3D;abs(sendleft);\n  sendright&#x3D;abs(sendright);\n\n  &#x2F;&#x2F;转字符发送\n&#x2F;&#x2F;  Serial.print(sendleft);\n&#x2F;&#x2F;  Serial.print(&quot;  &quot;);\n&#x2F;&#x2F;  Serial.println(sendright);\n&#x2F;&#x2F;  for(int i&#x3D;4;i&lt;&#x3D;13;i++)\n&#x2F;&#x2F;  &#123;\n&#x2F;&#x2F;    Serial.print(light[i]);\n&#x2F;&#x2F;    Serial.print(&quot;  &quot;);\n&#x2F;&#x2F;  &#125;\n&#x2F;&#x2F;  Serial.print(&quot;\\n&quot;);\n  HC.print(&#39;L&#39;);\n  HC.print(leftsig);\n  HC.print(sendleft);\n  HC.print(&#39;R&#39;);\n  HC.print(rightsig);\n  HC.print(sendright);\n  HC.print(&#39;x&#39;);\n  HC.print(&#39;z&#39;);\n  &#125;\n  &#x2F;&#x2F;----------------------------------------end of receive--------------------------------\n  &#x2F;&#x2F;HC.print(charright);\n  if(gcount%5&#x3D;&#x3D;0)\n  &#123;\n    digitalWrite(4,light[4]);\n    digitalWrite(5,light[5]);\n&#x2F;&#x2F;    digitalWrite(6,0);\n&#x2F;&#x2F;    digitalWrite(7,0);\n&#x2F;&#x2F;    digitalWrite(8,0);\n&#x2F;&#x2F;    digitalWrite(9,0);\n&#x2F;&#x2F;    digitalWrite(10,0);\n&#x2F;&#x2F;    digitalWrite(11,0);\n    digitalWrite(12,0);\n    digitalWrite(13,0);\n  &#125;\n  else\n  if(gcount%5&#x3D;&#x3D;1)\n  &#123;\n    digitalWrite(4,0);\n    digitalWrite(5,0);\n    digitalWrite(6,light[6]);\n    digitalWrite(7,light[7]);\n&#x2F;&#x2F;    digitalWrite(8,0);\n&#x2F;&#x2F;    digitalWrite(9,0);\n&#x2F;&#x2F;    digitalWrite(10,0);\n&#x2F;&#x2F;    digitalWrite(11,0);\n&#x2F;&#x2F;    digitalWrite(12,0);\n&#x2F;&#x2F;    digitalWrite(13,0); \n  &#125;\n  else\n  if(gcount%5&#x3D;&#x3D;2)\n  &#123;\n&#x2F;&#x2F;    digitalWrite(4,0);\n&#x2F;&#x2F;    digitalWrite(5,0);\n    digitalWrite(6,0);\n    digitalWrite(7,0);\n    digitalWrite(8,light[8]);\n    digitalWrite(9,light[9]);\n&#x2F;&#x2F;    digitalWrite(10,0);\n&#x2F;&#x2F;    digitalWrite(11,0);\n&#x2F;&#x2F;    digitalWrite(12,0);\n&#x2F;&#x2F;    digitalWrite(13,0); \n  &#125;\n  else\n  if(gcount%5&#x3D;&#x3D;3)\n  &#123;\n&#x2F;&#x2F;    digitalWrite(4,0);\n&#x2F;&#x2F;    digitalWrite(5,0);\n&#x2F;&#x2F;    digitalWrite(6,0);\n&#x2F;&#x2F;    digitalWrite(7,0);\n    digitalWrite(8,0);\n    digitalWrite(9,0);\n    digitalWrite(10,light[10]);\n    digitalWrite(11,light[11]);\n&#x2F;&#x2F;    digitalWrite(12,0);\n&#x2F;&#x2F;    digitalWrite(13,0); \n  &#125;\n  else\n  if(gcount%5&#x3D;&#x3D;4)\n  &#123;\n&#x2F;&#x2F;    digitalWrite(4,0);\n&#x2F;&#x2F;    digitalWrite(5,0);\n&#x2F;&#x2F;    digitalWrite(6,0);\n&#x2F;&#x2F;    digitalWrite(7,0);\n&#x2F;&#x2F;    digitalWrite(8,0);\n&#x2F;&#x2F;    digitalWrite(9,0);\n    digitalWrite(10,0);\n    digitalWrite(11,0);\n    digitalWrite(12,light[12]);\n    digitalWrite(13,light[13]); \n  &#125;\n\n   \n&#x2F;&#x2F;    Serial.print(&#39;L&#39;);\n&#x2F;&#x2F;  Serial.print(leftsig);\n&#x2F;&#x2F;  Serial.print(charleft);\n&#x2F;&#x2F;  Serial.print(&#39;R&#39;);\n&#x2F;&#x2F;  Serial.print(rightsig);\n&#x2F;&#x2F;  Serial.print(charright);\n&#125;<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>\n\n</p>\n</details>\n<h3 id=\"遥控组接收-车上的代码\"><a href=\"#遥控组接收-车上的代码\" class=\"headerlink\" title=\"遥控组接收 (车上的代码)\"></a>遥控组接收 (车上的代码)</h3><details class=\"custom-details\">\n<summary>Details</summary>\n<p><pre class=\"line-numbers language-c++\" data-language=\"c++\"><code class=\"language-c++\">#include &lt;SoftwareSerial.h&gt;\nSoftwareSerial HC(7,4);&#x2F;&#x2F;RX,TX\nvoid setup() &#123;\n  &#x2F;&#x2F; put your setup code here, to run once:\n  Serial.begin(9600);\n  HC.begin(9600);\n  attachInterrupt(digitalPinToInterrupt(2), left, RISING);&#x2F;&#x2F;2为左边中断口\n  attachInterrupt(digitalPinToInterrupt(3), right, RISING);&#x2F;&#x2F;3为右边中断口\n  pinMode(6, OUTPUT); &#x2F;&#x2F;in2\n  pinMode(5, OUTPUT); &#x2F;&#x2F;in1（left）\n  pinMode(10,INPUT);\n  pinMode(12,INPUT);\n  pinMode(11, OUTPUT); &#x2F;&#x2F;in2(right)\n  pinMode(9, OUTPUT); &#x2F;&#x2F;in1\n&#125;\nlong int leftcount&#x3D;0;\nlong int rightcount&#x3D;0;\nvoid left()\n&#123;\n  if(digitalRead(10)&#x3D;&#x3D;1)\n  leftcount++;\n  else\n  leftcount--;\n&#125;\nvoid right()\n&#123;\n  if(digitalRead(12)&#x3D;&#x3D;0)\n  rightcount++;\n  else\n  rightcount--;\n&#125;\n\nint leftlasterr&#x3D;0;&#x2F;&#x2F;左边lasterr\nint leftnowerr&#x3D;0;&#x2F;&#x2F;左边当前误差\nfloat leftout&#x3D;0;&#x2F;&#x2F;左边输出\nvoid leftpid(float lefttar)\n&#123;\n  leftnowerr&#x3D;lefttar-leftcount;\n  &#x2F;&#x2F;Serial.print(leftnowerr);\n  leftout+&#x3D;leftnowerr*1.5+(leftnowerr-leftlasterr)*7.5;\n  if(leftout&gt;255)\n    leftout&#x3D;255;\n  if(leftout&lt;-255)\n    leftout&#x3D;-255;\n  if(abs(leftnowerr)&lt;&#x3D;1&amp;&amp;abs(lefttar)&lt;&#x3D;1)\n  leftout&#x3D;0;\n&#125;\nint rightlasterr&#x3D;0;&#x2F;&#x2F;左边lasterr\nint rightnowerr&#x3D;0;&#x2F;&#x2F;左边当前误差\nfloat rightout&#x3D;0;&#x2F;&#x2F;左边输出\nvoid rightpid(float righttar)\n&#123;\n  rightnowerr&#x3D;righttar-rightcount;\n  rightout+&#x3D;rightnowerr*1.5+(rightnowerr-rightlasterr)*7.5;\n  if(rightout&gt;255)\n    rightout&#x3D;255;\n  if(rightout&lt;-255)\n    rightout&#x3D;-255;\n  if(abs(rightnowerr)&lt;1&amp;&amp;abs(righttar)&lt;1)\n  rightout&#x3D;0;\n&#125;\n\n\n\nString rec;\nvoid loop() &#123;\n  &#x2F;&#x2F; put your main code here, to run repeatedly:\n  \n  &#x2F;&#x2F;Serial.println(HC.available());\n  char re;\n  int left;\n  int right;\n  char leftsig;\n  char rightsig;\n  int i&#x3D;0;\n  int j&#x3D;0;\n  int len;\n  float leftmotor;\n  float rightmotor;\n  int left1,left2,left3,right1,right2,right3;\n  &#x2F;&#x2F;Serial.println(&quot;ok&quot;);\n  if(HC.available())\n  &#123;\n      i&#x3D;0;\n      j&#x3D;0;\n      rec&#x3D;HC.readStringUntil(&#39;z&#39;);\n      len&#x3D;rec.length();\n      &#x2F;&#x2F;Serial.println(rec);\n      while(i&lt;len&amp;&amp;rec[i]!&#x3D;&#39;R&#39;)\n      &#123;\n        i++;\n      &#125;\n      switch(i)\n      &#123;\n        case 5:\n          &#123;\n            if(rec[1]&#x3D;&#x3D;&#39;+&#39;)\n              left&#x3D;100;\n            else\n              left&#x3D;-100;\n            break;\n          &#125;\n        case 4:\n          &#123;\n            if(rec[1]&#x3D;&#x3D;&#39;+&#39;)\n            left&#x3D;10*(rec[2]-&#39;0&#39;)+rec[3]-&#39;0&#39;;\n            else\n            left&#x3D;-(10*(rec[2]-&#39;0&#39;)+rec[3]-&#39;0&#39;);\n            break;\n          &#125;\n         case 3:\n          &#123;\n            if(rec[1]&#x3D;&#x3D;&#39;+&#39;)\n            left&#x3D;rec[2]-&#39;0&#39;;\n            else\n            left&#x3D;-(rec[2]-&#39;0&#39;);\n            break;\n          &#125;\n         default:\n          left&#x3D;0;\n      &#125;\n      while(i+j&lt;len&amp;&amp;rec[i+j]!&#x3D;&#39;x&#39;)\n      &#123;\n        j++;\n      &#125;\n      switch(j)\n      &#123;\n        case 5:\n          &#123;\n            if(rec[i+1]&#x3D;&#x3D;&#39;+&#39;)\n              right&#x3D;100;\n            else\n              right&#x3D;-100;\n            break;\n          &#125;\n        case 4:\n          &#123;\n            if(rec[i+1]&#x3D;&#x3D;&#39;+&#39;)\n            right&#x3D;10*(rec[i+2]-&#39;0&#39;)+rec[i+3]-&#39;0&#39;;\n            else\n            right&#x3D;-(10*(rec[i+2]-&#39;0&#39;)+rec[i+3]-&#39;0&#39;);\n            break;\n          &#125;\n         case 3:\n          &#123;\n            if(rec[i+1]&#x3D;&#x3D;&#39;+&#39;)\n            right&#x3D;rec[i+2]-&#39;0&#39;;\n            else\n            right&#x3D;-(rec[i+2]-&#39;0&#39;);\n            break;\n          &#125;\n         default:\n          right&#x3D;0;\n      &#125;\n      \n  &#125;&#x2F;&#x2F;读取遥控器数值end\n      &#x2F;&#x2F;left*&#x3D;0.5;\n&#x2F;&#x2F;可用\n      if(abs(left)&gt;&#x3D;10)\n      &#123;\n        leftmotor&#x3D;left*(100+right)&#x2F;100.0;\n        rightmotor&#x3D;left*(100-right)&#x2F;100.0;\n      &#125;\n      else\n      &#123;\n        leftmotor&#x3D;left+right*0.09;\n        rightmotor&#x3D;left-right*0.09;\n      &#125;\n&#x2F;&#x2F;可用勿删 \n      float t&#x3D;abs(left);\n      if(t&lt;&#x3D;10)\n      &#123;\n        leftmotor&#x3D;left+right*0.09;\n        rightmotor&#x3D;left-right*0.09;\n      &#125;\n      if(t&gt;10&amp;&amp;t&lt;&#x3D;20)\n      &#123;\n        leftmotor&#x3D;left+right*0.13;\n        rightmotor&#x3D;left-right*0.13;  \n      &#125;\n      if(t&gt;20&amp;&amp;t&lt;&#x3D;30)\n      &#123;\n        leftmotor&#x3D;left+right*0.17;\n        rightmotor&#x3D;left-right*0.17;  \n      &#125;\n      if(t&gt;30&amp;&amp;t&lt;&#x3D;40)\n      &#123;\n        leftmotor&#x3D;left+right*0.5;\n        rightmotor&#x3D;left-right*0.5;  \n      &#125;\n      if(t&gt;40)\n      &#123;\n        leftmotor&#x3D;left+right*1;\n        rightmotor&#x3D;left-right*1; \n      &#125;\n      \n      \n      \n      &#x2F;&#x2F;计算速度\n      \n      if(leftmotor&gt;100)\n      &#123;\n        leftmotor&#x3D;100;\n      &#125;\n      if(leftmotor&lt;-100)\n      &#123;\n        leftmotor&#x3D;-100;\n      &#125;\n      if(rightmotor&gt;100)\n      &#123;\n        rightmotor&#x3D;100;\n      &#125;\n      if(rightmotor&lt;-100)\n      &#123;\n        rightmotor&#x3D;-100;\n      &#125;\n      &#x2F;&#x2F;解算速度\n      &#x2F;&#x2F;右边电机驱动\n      leftpid((int)leftmotor);&#x2F;&#x2F;-------------------pid计算\n      rightpid((int)rightmotor);\n&#x2F;&#x2F;      Serial.print(left);&#x2F;&#x2F;期望转速\n&#x2F;&#x2F;      Serial.print(&quot; &quot;);\n&#x2F;&#x2F;      Serial.print(right);&#x2F;&#x2F;期望转速\n&#x2F;&#x2F;      Serial.println(&quot; &quot;);\n      \n      Serial.print(leftmotor*0.4);&#x2F;&#x2F;期望转速\n      Serial.print(&quot; &quot;);\n      Serial.print(leftcount);&#x2F;&#x2F;实际转速\n      Serial.print(&quot; &quot;);\n      Serial.print(&quot; &quot;);\n      Serial.print(leftout);&#x2F;&#x2F;输出\n      Serial.print(rightmotor*0.4);&#x2F;&#x2F;期望转速\n      Serial.print(&quot; &quot;);\n      Serial.print(rightcount);&#x2F;&#x2F;实际转速\n      Serial.print(&quot; &quot;);\n      Serial.println(rightout);&#x2F;&#x2F;输出\n      if(rightout&gt;0)\n      &#123;\n        digitalWrite(11, LOW);\n        analogWrite(9, (int)rightout);\n      &#125;\n      if(rightout&lt;0)\n      &#123;\n        digitalWrite(9, LOW);\n        analogWrite(11, (int)abs(rightout));\n      &#125;\n      if(rightout&#x3D;&#x3D;0)\n      &#123;\n        digitalWrite(11, LOW);\n        digitalWrite(9, LOW);\n      &#125;\n      &#x2F;&#x2F;左边电机驱动\n      if(leftout&gt;0)\n      &#123;\n        digitalWrite(5, LOW);\n        analogWrite(6, (int)leftout);\n      &#125;\n      if(leftout&lt;0)\n      &#123;\n        digitalWrite(6, LOW);\n        analogWrite(5, (int)abs(leftout));\n      &#125;\n      if(leftout&#x3D;&#x3D;0)\n      &#123;\n        digitalWrite(5, LOW);\n        digitalWrite(6, LOW);\n      &#125;\n  &#x2F;&#x2F;更新数据，清除编码器\n  leftlasterr&#x3D;leftnowerr;\n  rightlasterr&#x3D;rightnowerr;\n  leftcount&#x3D;0;\n  rightcount&#x3D;0;\n  delay(25);\n&#125;<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>\n\n</p>\n</details>\n<h3 id=\"电磁组\"><a href=\"#电磁组\" class=\"headerlink\" title=\"电磁组\"></a>电磁组</h3><details class=\"custom-details\">\n<summary>Details</summary>\n<p><pre class=\"line-numbers language-c++\" data-language=\"c++\"><code class=\"language-c++\">void setup() &#123;\n  &#x2F;&#x2F; put your setup code here, to run once:\n  Serial.begin(9600);\n  attachInterrupt(digitalPinToInterrupt(2), left, RISING);&#x2F;&#x2F;2为左边中断口\n  attachInterrupt(digitalPinToInterrupt(3), right, RISING);&#x2F;&#x2F;3为右边中断口\n  pinMode(6, OUTPUT); &#x2F;&#x2F;in2\n  pinMode(5, OUTPUT); &#x2F;&#x2F;in1（left）\n  pinMode(10,INPUT);\n  pinMode(12,INPUT);\n  pinMode(11, OUTPUT); &#x2F;&#x2F;in2(right)\n  pinMode(9, OUTPUT); &#x2F;&#x2F;in1\n&#125;\nlong int leftcount&#x3D;0;\nlong int rightcount&#x3D;0;\nvoid left()\n&#123;\n  if(digitalRead(10)&#x3D;&#x3D;1)\n  leftcount++;\n  else\n  leftcount--;\n&#125;\nvoid right()\n&#123;\n  if(digitalRead(12)&#x3D;&#x3D;0)\n  rightcount++;\n  else\n  rightcount--;\n&#125;\n\nfloat leftlasterr&#x3D;0;&#x2F;&#x2F;左边lasterr\nfloat leftnowerr&#x3D;0;&#x2F;&#x2F;左边当前误差\nfloat leftout&#x3D;0;&#x2F;&#x2F;左边输出\nint leftpid(float lefttar)\n&#123;\n  leftnowerr&#x3D;lefttar-leftcount;\n  leftout+&#x3D;leftnowerr*2+(leftnowerr-leftlasterr)*8;\n  if(leftout&gt;255)\n    leftout&#x3D;255;\n  if(leftout&lt;-255)\n    leftout&#x3D;-255;\n  if(abs(leftnowerr)&lt;1&amp;&amp;abs(lefttar)&lt;1)\n  leftout&#x3D;0;\n&#125;\nfloat rightlasterr&#x3D;0;&#x2F;&#x2F;左边lasterr\nfloat rightnowerr&#x3D;0;&#x2F;&#x2F;左边当前误差\nfloat rightout&#x3D;0;&#x2F;&#x2F;左边输出\nint rightpid(float righttar)\n&#123;\n  rightnowerr&#x3D;righttar-rightcount;\n  rightout+&#x3D;rightnowerr*2+(rightnowerr-rightlasterr)*8;\n  if(rightout&gt;255)\n    rightout&#x3D;255;\n  if(rightout&lt;-255)\n    rightout&#x3D;-255;\n  if(abs(rightnowerr)&lt;1&amp;&amp;abs(righttar)&lt;1)\n  rightout&#x3D;0;\n&#125;\n\n\nfloat leftmotor&#x3D;20;\nfloat rightmotor&#x3D;20;\nint basespeed&#x3D;100;&#x2F;&#x2F;100 30s\nfloat p&#x3D;0.6;\nvoid loop() &#123;\n  &#x2F;&#x2F; put your main code here, to run repeatedly:\n  delay(50);\n  float x1 &#x3D; analogRead(A0)&#x2F;3.0;&#x2F;&#x2F;left\n  float x2 &#x3D; analogRead(A1)&#x2F;3.0;&#x2F;&#x2F;right\n  float x3 &#x3D; analogRead(A2)&#x2F;3.0;&#x2F;&#x2F;right\n  float x4 &#x3D; analogRead(A3)&#x2F;3.0;&#x2F;&#x2F;right\n\n  int last_x1&#x3D;x1;\n  int last_x2&#x3D;x2;\n  int last_x3&#x3D;x3;\n  int last_x4&#x3D;x4;\n  float err&#x3D;x2-x3;&#x2F;&#x2F;正的偏差左转，负的右转\n  float err1&#x3D;x1-x4;\n  float err2&#x3D;(x1+x2)&#x2F;2-(x3+x4)&#x2F;2;\n  float err3&#x3D;(err+err1)&#x2F;2;\n  \n&#x2F;&#x2F;  Serial.print(x1);\n&#x2F;&#x2F;  Serial.print(&#39; &#39;);\n&#x2F;&#x2F;  Serial.print(x2);\n&#x2F;&#x2F;  Serial.print(&#39; &#39;);\n&#x2F;&#x2F;  Serial.print(x3);\n&#x2F;&#x2F;  Serial.print(&#39; &#39;);\n&#x2F;&#x2F;  Serial.print(x4);\n&#x2F;&#x2F;  Serial.print(&#39; &#39;);\n  Serial.print(err3);\n  Serial.print(&#39; &#39;);\n  Serial.print(basespeed-err3*p);\n  Serial.print(&#39; &#39;);\n  Serial.print(basespeed+err3*p);\n  Serial.print(&#39; &#39;);\n  Serial.print(leftcount);\n  Serial.print(&#39; &#39;);\n  Serial.println(rightcount);\n  \n&#x2F;&#x2F;      Serial.print(leftmotor);&#x2F;&#x2F;期望转速\n&#x2F;&#x2F;      Serial.print(&quot; &quot;);\n&#x2F;&#x2F;      Serial.print(leftcount);&#x2F;&#x2F;实际转速\n&#x2F;&#x2F;      Serial.print(&quot; &quot;);\n&#x2F;&#x2F;      Serial.print(&quot; &quot;);\n&#x2F;&#x2F;      Serial.print(leftout);&#x2F;&#x2F;输出\n&#x2F;&#x2F;      Serial.print(rightmotor);&#x2F;&#x2F;期望转速\n&#x2F;&#x2F;      Serial.print(&quot; &quot;);\n&#x2F;&#x2F;      Serial.print(rightcount);&#x2F;&#x2F;实际转速\n&#x2F;&#x2F;      Serial.print(&quot; &quot;);\n&#x2F;&#x2F;      Serial.println(rightout);&#x2F;&#x2F;输出\n  \n  leftpid(basespeed-err3*p);&#x2F;&#x2F;-------------------pid计算\n  rightpid(basespeed+err3*p);\n  &#x2F;&#x2F;Serial.println(leftout);\n  if(rightout&gt;0)\n      &#123;\n        digitalWrite(11, LOW);\n        analogWrite(9, (int)rightout);\n      &#125;\n      if(rightout&lt;0)\n      &#123;\n        digitalWrite(9, LOW);\n        analogWrite(11, (int)abs(rightout));\n      &#125;\n      if(rightout&#x3D;&#x3D;0)\n      &#123;\n        digitalWrite(11, LOW);\n        digitalWrite(9, LOW);\n      &#125;\n      &#x2F;&#x2F;左边电机驱动\n      if(leftout&gt;0)\n      &#123;\n        digitalWrite(5, LOW);\n        analogWrite(6, (int)leftout);\n      &#125;\n      if(leftout&lt;0)\n      &#123;\n        digitalWrite(6, LOW);\n        analogWrite(5, (int)abs(leftout));\n      &#125;\n      if(leftout&#x3D;&#x3D;0)\n      &#123;\n        digitalWrite(5, LOW);\n        digitalWrite(6, LOW);\n      &#125;\n  &#x2F;&#x2F;更新数据，清除编码器\n  leftlasterr&#x3D;leftnowerr;\n  rightlasterr&#x3D;rightnowerr;\n  leftcount&#x3D;0;\n  rightcount&#x3D;0;\n&#125;<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>\n\n</p>\n</details>\n<div class=\"custom-quote tip\">\n<span class=\"custom-quote-svg\"><svg width=\"24\" height=\"24\" viewBox=\"0 0 24 24\" fill=\"\" xmlns=\"http://www.w3.org/2000/svg\" data-reactroot=\"\">\n<path fill=\"\" d=\"M20.86 14.13C20 14.7 19.56 15.74 19.77 16.76C20.13 18.55 18.55 20.13 16.76 19.77C15.74 19.57 14.7 20 14.13 20.86C13.12 22.38 10.89 22.38 9.88 20.86C9.3 20 8.26 19.56 7.24 19.77C5.45 20.13 3.87 18.55 4.23 16.76C4.43 15.74 4 14.7 3.14 14.13C1.62 13.12 1.62 10.89 3.14 9.88C4 9.3 4.44 8.26 4.23 7.24C3.87 5.45 5.45 3.87 7.24 4.23C8.26 4.44 9.3 4 9.87 3.14C10.88 1.62 13.11 1.62 14.12 3.14C14.7 4 15.74 4.44 16.76 4.23C18.55 3.87 20.13 5.45 19.77 7.24C19.56 8.26 20 9.3 20.86 9.87C22.38 10.88 22.38 13.12 20.86 14.13Z\" undefined=\"1\"></path>\n<path stroke-linejoin=\"round\" stroke-linecap=\"round\" stroke-miterlimit=\"10\" stroke-width=\"2\" stroke=\"\" d=\"M12.01 15C12.01 14.5 12.01 14.5 12.01 14.5C12.04 13.75 13 13.46 14.04 12.2C14.41 11.74 14.69 11.41 14.86 10.85C15.15 9.95 14.92 9.18 14.86 9.02C14.8 8.79 14.52 8 13.72 7.46C13.06 7.02 12.42 7 12.14 7C11.9 7 11.36 7 10.78 7.3C10.28 7.56 9.98 7.9 9.83 8.1C9.24 8.82 9.06 9.63 9 10.06\"></path>\n<path stroke-linecap=\"round\" stroke-miterlimit=\"10\" stroke-width=\"2\" stroke=\"\" d=\"M11.99 18H12.01\"></path>\n</svg></span>\n<p class=\"custom-quote-title\">TIP</p>\n<p>感谢观看~ </p>\n\n</div>\n<p>by rocket 202211.21 23:14</p>\n","text":"比赛要求本次科技节比赛要求通过遥控和电磁的方式，让小车绕着赛道跑一圈，时间最短者获胜 遥控器和小车必须用单片机控制 PCB必须自制或者用洞洞板 赛道如下： （并没有三叉路口，对新生十分友好） 设计思路总体思路开发板为了在短时间内快速完成开发，采用了arduino开发板 谁能拒绝一...","link":"","photos":[],"count_time":{"symbolsCount":"22k","symbolsTime":"20 mins."},"categories":[{"name":"开发记录","slug":"开发记录","count":1,"path":"api/categories/开发记录.json"}],"tags":[{"name":"嵌入式开发","slug":"嵌入式开发","count":1,"path":"api/tags/嵌入式开发.json"}],"toc":"<ol class=\"toc\"><li class=\"toc-item toc-level-1\"><a class=\"toc-link\" href=\"#%E6%AF%94%E8%B5%9B%E8%A6%81%E6%B1%82\"><span class=\"toc-text\">比赛要求</span></a></li><li class=\"toc-item toc-level-1\"><a class=\"toc-link\" href=\"#%E8%AE%BE%E8%AE%A1%E6%80%9D%E8%B7%AF\"><span class=\"toc-text\">设计思路</span></a><ol class=\"toc-child\"><li class=\"toc-item toc-level-2\"><a class=\"toc-link\" href=\"#%E6%80%BB%E4%BD%93%E6%80%9D%E8%B7%AF\"><span class=\"toc-text\">总体思路</span></a><ol class=\"toc-child\"><li class=\"toc-item toc-level-3\"><a class=\"toc-link\" href=\"#%E5%BC%80%E5%8F%91%E6%9D%BF\"><span class=\"toc-text\">开发板</span></a></li><li class=\"toc-item toc-level-3\"><a class=\"toc-link\" href=\"#%E8%BD%A6%E6%A8%A1\"><span class=\"toc-text\">车模</span></a></li><li class=\"toc-item toc-level-3\"><a class=\"toc-link\" href=\"#%E7%94%B5%E6%9C%BA%E9%A9%B1%E5%8A%A8\"><span class=\"toc-text\">电机驱动</span></a></li></ol></li><li class=\"toc-item toc-level-2\"><a class=\"toc-link\" href=\"#%E9%81%A5%E6%8E%A7%E8%BD%A6%E6%80%9D%E8%B7%AF\"><span class=\"toc-text\">遥控车思路</span></a><ol class=\"toc-child\"><li class=\"toc-item toc-level-4\"><a class=\"toc-link\" href=\"#%E9%A6%96%E5%85%88%EF%BC%8C%E9%9C%80%E8%A6%81%E6%9C%89%E4%B8%80%E4%B8%AA%E9%81%A5%E6%8E%A7%E5%99%A8\"><span class=\"toc-text\">首先，需要有一个遥控器</span></a></li><li class=\"toc-item toc-level-4\"><a class=\"toc-link\" href=\"#%E6%8E%A5%E7%9D%80%EF%BC%8C%E8%A6%81%E8%BF%9B%E8%A1%8C%E9%80%9A%E4%BF%A1\"><span class=\"toc-text\">接着，要进行通信</span></a></li><li class=\"toc-item toc-level-4\"><a class=\"toc-link\" href=\"#%E5%86%8D%E8%80%85%EF%BC%8C%E8%A6%81%E8%AE%A9%E8%BD%A6%E8%B7%91%E8%B5%B7%E6%9D%A5\"><span class=\"toc-text\">再者，要让车跑起来</span></a></li></ol></li><li class=\"toc-item toc-level-3\"><a class=\"toc-link\" href=\"#%E7%94%B5%E7%A3%81%E8%BD%A6%E6%80%9D%E8%B7%AF\"><span class=\"toc-text\">电磁车思路</span></a></li></ol></li></ol></li><li class=\"toc-item toc-level-1\"><a class=\"toc-link\" href=\"#%E6%AF%94%E8%B5%9B%E7%BB%93%E6%9E%9C\"><span class=\"toc-text\">比赛结果</span></a><ol class=\"toc-child\"><li class=\"toc-item toc-level-2\"><a class=\"toc-link\" href=\"#%E5%BC%80%E6%BA%90%E7%8E%AF%E8%8A%82\"><span class=\"toc-text\">开源环节</span></a><ol class=\"toc-child\"><li class=\"toc-item toc-level-3\"><a class=\"toc-link\" href=\"#%E9%81%A5%E6%8E%A7%E7%BB%84%E5%8F%91%E9%80%81%EF%BC%88%E9%81%A5%E6%8E%A7%E5%99%A8%E4%BB%A3%E7%A0%81%EF%BC%89\"><span class=\"toc-text\">遥控组发送（遥控器代码）</span></a></li><li class=\"toc-item toc-level-3\"><a class=\"toc-link\" href=\"#%E9%81%A5%E6%8E%A7%E7%BB%84%E6%8E%A5%E6%94%B6-%E8%BD%A6%E4%B8%8A%E7%9A%84%E4%BB%A3%E7%A0%81\"><span class=\"toc-text\">遥控组接收 (车上的代码)</span></a></li><li class=\"toc-item toc-level-3\"><a class=\"toc-link\" href=\"#%E7%94%B5%E7%A3%81%E7%BB%84\"><span class=\"toc-text\">电磁组</span></a></li></ol></li></ol></li></ol>","author":{"name":"rock3t","slug":"blog-author","avatar":"https://img-blog.csdnimg.cn/20210313122054101.png","link":"/","description":"南京某邮专大一新生一枚 <br /> <text>目前技术方向：CTF、stm32、电赛</text>","socials":{"github":"https://github.com/rocket016","twitter":"","stackoverflow":"","wechat":"","qq":"","weibo":"","zhihu":"","csdn":"","juejin":"","customs":{}}},"mapped":true,"prev_post":{},"next_post":{}}